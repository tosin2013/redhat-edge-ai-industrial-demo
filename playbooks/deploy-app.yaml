---
- name: Deploy to MicroShift 
  hosts: all
  gather_facts: no
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  tasks:
    - name: Create a namespace
      k8s:
        state: present
        api_version: v1
        kind: Namespace
        name: "{{namespace }}"

    - name: Apply Service Account 
      kubernetes.core.k8s:
        state: present
        template:
          - path: 'service-account.yaml.j2'

    - name: Apply Role Binding
      kubernetes.core.k8s:
        state: present
        template:
          - path: 'rb-template.yaml.j2'

    - name: Apply MicroShift Deployment
      k8s:
        state: present
        template:
          - path: 'dc-template.yaml.j2'

    - name: Apply MicroShift Service
      k8s:
        state: present
        template:
          - path: 'svc-template.yaml.j2'