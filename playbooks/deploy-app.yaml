---
- name: Deploy to OpenShift 
  hosts: localhost
  gather_facts: no
  environment:
    KUBECONFIG: "{{ kubeconfig_path }}"
  tasks:
    - name: Create a namespace
      k8s:
        state: present
        api_version: v1
        kind: Namespace
        name: "{{namespace }}"

    - name: Render MicroShift Deployment
      template:
        src: dc-template.yaml.j2
        dest: "{{ output_path }}/deployment.yaml"  

    - name: Apply MicroShift Deployment
      k8s:
        state: present
        definition: "{{ output_path }}/deployment.yaml"  

    - name: Render MicroShift Service
      template:
        src: svc-template.yaml.j2 
        dest: "{{ output_path  }}/svc.yaml"
      vars:

    - name: Apply MicroShift Service
      k8s:
        state: present
        definition: "{{ output_path  }}/svc.yaml"